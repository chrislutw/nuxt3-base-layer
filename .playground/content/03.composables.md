---
title: Composables
description: 可重用的功能函式
---

## vueUse

使用 [vueUse](https://vueuse.org/) 的功能。

::code-preview
::demo-vue-use
::
::

## API 呼叫

使用 Nuxt 的 $fetch API 包裝公共 API、需要認證的 API 和第三方公共 API 的 composables。

如果是使用按鈕觸發的 API 呼叫，`usePublicApi`, `useAuthApi`, `useThirdPartyPublicApi` 皆可以直接使用。

如果是頁面級別的 API，請使用 nuxt 提供的 `useAsyncData` 作搭配，不然會導致 API 呼叫2次(server-side 和 client-side)。

### usePublicApi(url, fetchOptions, apiOptions)

包裝 nuxt 的 $fetch API 使用公共 API 的 composables。

可調整 `config.public.apiBaseUrl` 參數更改 API 的基礎 URL(`baseURL`)。

#### fetchOptions

同 `ofetch` 的 `FetchOptions`，可以用來設定 headers、method、body 等等。

#### apiOptions

- `alert`: 預設為 true, 當為 true 時，會在發生錯誤時彈出錯誤訊息。
- `checkSuccessHandler`: 可訂製成功的檢查邏輯，預設會檢查 .net core API 的 Code 是否為 0。

#### example

```ts
export async function useLangApi(langCode: string) {
  const config = useRuntimeConfig()
  // baseURL 可以直接更換 config.public.i18nBaseUrl 帶在 url 中
  const langUrl = `${config.public.i18nBaseUrl}/Language/${langCode}?GroupIds[]=TOURNWEB`
  const res = await usePublicApi<Record<string, any>>(langUrl, {}, { alert: true })
  // 或者使用 fetchOptions 更換 baseURL
  // const res = await usePublicApi<Record<string, any>>(langUrl, { baseURL: config.public.i18nBaseUrl }, { alert: true })
  return res?.Data
}
```

#### Types

```ts
function usePublicApi<DataT, ResponseT = CoreApiResponse<DataT>>(
  url: string,
  fetchOptions?: NitroFetchOptions<NitroFetchRequest>,
  apiOptions?: ApiOptionsWithResponse<DataT, ResponseT>,
): Promise<ResponseT | undefined>

// .net core API 的預設回應格式
export type CoreApiResponse<DataT> = {
  Code: number
  Data: DataT
  Message?: string
}

// 當傳入兩個型別參數時使用的 ApiOptions
export type ApiOptionsWithResponse<DataT, RespT> = {
  alert?: boolean
  checkSuccessHandler?: (res: RespT, url: string, apiOptions: ApiOptionsWithResponse<DataT, RespT>) => void
}
```

### useAuthApi(url, fetchOptions, apiOptions)

使用 `usePublicApi` 實作，擁有 `usePublicApi` 的所有功能。

並會從 `cookies` 中取得 `token`，並在 `fetchOptions` 中自動加入 `Authorization` 標頭。

#### example

```ts
export async function useProjectErrorApi() {
  const url = `/history/ab/get-history-record`
  const res = await usePublicApi<Record<string, any>>(url, {}, { alert: true })
  return res?.Data
}
```

#### Types

與 `usePublicApi` 相同。

### useThirdPartyPublicApi(url, fetchOptions, apiOptions)

包裝 nuxt 的 $fetch API 使用第三方公共 API 的 composables。

#### example

```ts
export async function useThirdPartyApi() {
  const url = `https://jsonplaceholder.typicode.com/posts/1`
  const res = await useThirdPartyPublicApi<Record<string, any>>(url, {}, { alert: true })
  return res
}
```

搭配 `useAsyncData` 使用：

```ts
type ThirdPartyDataPost = {
  userId: number
  id: number
  title: string
  body: string
}
// 頁面級別的 API，供整個頁面使用，可使用多個 $fetch API 組成
const { data, refresh } = await useAsyncData('dataKey', async () => {
  const url = `https://jsonplaceholder.typicode.com/posts/1`
  const res = await useThirdPartyPublicApi<ThirdPartyDataPost>(url, {}, { alert: true }) || null

  // useAsyncData 需要回傳 null 或是有值，不能是 undefined
  return res
})
```

### Demo

#### api 呼叫

::code-preview
::demo-api
::
::

#### asyncData 搭配使用 third party api

::code-preview

::demo-third-party-api
::

::

#### Types

與 `usePublicApi` 相同。

## useLogger

包裝 console 並在 正式環境下不輸出 log。

當有 `query.log` 時，會顯示 level = 3 的 log。

當有 `query.debug` 時，會顯示 level = 4 的 log。

```ts
// 普通使用 log
const logger = useLogger()

logger.log('foo')
// output: foo

// 加上 tag 名稱
const logger = useLogger().withTag('home page')

logger.log('bar')
// output: [home page] bar
```

## usePageStyle

設定頁面樣式 `--ui-bg`, `--ui-text` ，並在 `body` 上套用。

### example

```ts
const pageStyle = usePageStyle({
  bg: 'var(--ui-color-primary-50)',
  text: 'var(--ui-color-primary-900)',
  dark: {
    bg: 'var(--ui-color-primary-950)',
    text: 'var(--ui-color-primary-50)',
  },
})

// pageStyle.value = {
//   '--ui-bg': 'var(--ui-color-primary-50)',
//   '--ui-text': 'var(--ui-color-primary-900)'
// }
// on dark mode, it will be:
// pageStyle.value = {
//   '--ui-bg': 'var(--ui-color-primary-950)',
//   '--ui-text': 'var(--ui-color-primary-50)'
// }

useHead({
  bodyAttrs: {
    class: pageStyle.value,
  },
})
```

## useToastSSR

在 Server Side 時記錄訊息，在 Client Side 時顯示

包裝 toast 並處理 SSR 環境下的 toast 訊息，因為 toast 在 SSR 環境下無法顯示，所以在 SSR 環境下的訊息，會先記錄到 `ssrToasts`，等到 Client Side 時再顯示。

### example

```ts
const toast = useToast() // 無法在 SSR 環境下使用
// 取代成
const toast = useToastSSR()
```
